{"id":"node_modules/node-vibrant/lib/image/browser.js","dependencies":[{"name":"/Users/christianreindl/Code/fenwick-ui/node_modules/node-vibrant/lib/image/browser.js.map","includedInParent":true,"mtime":499162500000},{"name":"/Users/christianreindl/Code/fenwick-ui/node_modules/node-vibrant/src/image/browser.ts","includedInParent":true,"mtime":499162500000},{"name":"/Users/christianreindl/Code/fenwick-ui/package.json","includedInParent":true,"mtime":1628361505277},{"name":"/Users/christianreindl/Code/fenwick-ui/node_modules/node-vibrant/package.json","includedInParent":true,"mtime":499162500000},{"name":"./base","loc":{"line":35,"column":21},"parent":"/Users/christianreindl/Code/fenwick-ui/node_modules/node-vibrant/lib/image/browser.js","resolved":"/Users/christianreindl/Code/fenwick-ui/node_modules/node-vibrant/lib/image/base.js"},{"name":"url","loc":{"line":36,"column":31},"parent":"/Users/christianreindl/Code/fenwick-ui/node_modules/node-vibrant/lib/image/browser.js","resolved":"/Users/christianreindl/Code/fenwick-ui/node_modules/url/url.js"}],"generated":{"js":"\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar base_1 = require(\"./base\");\nvar Url = __importStar(require(\"url\"));\nfunction isRelativeUrl(url) {\n    var u = Url.parse(url);\n    return u.protocol === null &&\n        u.host === null &&\n        u.port === null;\n}\nfunction isSameOrigin(a, b) {\n    var ua = Url.parse(a);\n    var ub = Url.parse(b);\n    // https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\n    return ua.protocol === ub.protocol &&\n        ua.hostname === ub.hostname &&\n        ua.port === ub.port;\n}\nvar BrowserImage = /** @class */ (function (_super) {\n    __extends(BrowserImage, _super);\n    function BrowserImage() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    BrowserImage.prototype._initCanvas = function () {\n        var img = this.image;\n        var canvas = this._canvas = document.createElement('canvas');\n        var context = this._context = canvas.getContext('2d');\n        canvas.className = 'vibrant-canvas';\n        canvas.style.display = 'none';\n        this._width = canvas.width = img.width;\n        this._height = canvas.height = img.height;\n        context.drawImage(img, 0, 0);\n        document.body.appendChild(canvas);\n    };\n    BrowserImage.prototype.load = function (image) {\n        var _this = this;\n        var img = null;\n        var src = null;\n        if (typeof image === 'string') {\n            img = document.createElement('img');\n            if (!isRelativeUrl(image) && !isSameOrigin(window.location.href, image)) {\n                img.crossOrigin = 'anonymous';\n            }\n            src = img.src = image;\n        }\n        else if (image instanceof HTMLImageElement) {\n            img = image;\n            src = image.src;\n        }\n        else {\n            return Promise.reject(new Error(\"Cannot load buffer as an image in browser\"));\n        }\n        this.image = img;\n        return new Promise(function (resolve, reject) {\n            var onImageLoad = function () {\n                _this._initCanvas();\n                resolve(_this);\n            };\n            if (img.complete) {\n                // Already loaded\n                onImageLoad();\n            }\n            else {\n                img.onload = onImageLoad;\n                img.onerror = function (e) { return reject(new Error(\"Fail to load image: \" + src)); };\n            }\n        });\n    };\n    BrowserImage.prototype.clear = function () {\n        this._context.clearRect(0, 0, this._width, this._height);\n    };\n    BrowserImage.prototype.update = function (imageData) {\n        this._context.putImageData(imageData, 0, 0);\n    };\n    BrowserImage.prototype.getWidth = function () {\n        return this._width;\n    };\n    BrowserImage.prototype.getHeight = function () {\n        return this._height;\n    };\n    BrowserImage.prototype.resize = function (targetWidth, targetHeight, ratio) {\n        var _a = this, canvas = _a._canvas, context = _a._context, img = _a.image;\n        this._width = canvas.width = targetWidth;\n        this._height = canvas.height = targetHeight;\n        context.scale(ratio, ratio);\n        context.drawImage(img, 0, 0);\n    };\n    BrowserImage.prototype.getPixelCount = function () {\n        return this._width * this._height;\n    };\n    BrowserImage.prototype.getImageData = function () {\n        return this._context.getImageData(0, 0, this._width, this._height);\n    };\n    BrowserImage.prototype.remove = function () {\n        if (this._canvas && this._canvas.parentNode) {\n            this._canvas.parentNode.removeChild(this._canvas);\n        }\n    };\n    return BrowserImage;\n}(base_1.ImageBase));\nexports.default = BrowserImage;\n"},"sourceMaps":{"js":{"version":3,"file":"browser.js","sourceRoot":"","sources":["../../src/image/browser.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-env browser */\nimport { Options, ImageData, ImageSource, ImageCallback } from '../typing'\nimport { ImageBase } from './base'\nimport * as Url from 'url'\n\nfunction isRelativeUrl (url: string): boolean {\n  let u = Url.parse(url)\n  return u.protocol === null &&\n    u.host === null &&\n    u.port === null\n}\n\nfunction isSameOrigin (a: string, b: string): boolean {\n  let ua = Url.parse(a)\n  let ub = Url.parse(b)\n\n  // https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy\n  return ua.protocol === ub.protocol &&\n    ua.hostname === ub.hostname &&\n    ua.port === ub.port\n}\n\nexport default class BrowserImage extends ImageBase {\n  image: HTMLImageElement\n  private _canvas: HTMLCanvasElement\n  private _context: CanvasRenderingContext2D\n  private _width: number\n  private _height: number\n  private _initCanvas (): void {\n    let img = this.image\n    let canvas = this._canvas = document.createElement('canvas')\n    let context = this._context = canvas.getContext('2d')!\n\n    canvas.className = 'vibrant-canvas'\n    canvas.style.display = 'none'\n\n    this._width = canvas.width = img.width\n    this._height = canvas.height = img.height\n\n    context!.drawImage(img, 0, 0)\n\n    document.body.appendChild(canvas)\n  }\n  load (image: ImageSource): Promise<ImageBase> {\n    let img: HTMLImageElement | null = null\n    let src: string | null = null\n    if (typeof image === 'string') {\n      img = document.createElement('img')\n      if (!isRelativeUrl(image) && !isSameOrigin(window.location.href, image)) {\n        img.crossOrigin = 'anonymous'\n      }\n      src = img.src = image\n    } else if (image instanceof HTMLImageElement) {\n      img = image\n      src = image.src\n    } else {\n      return Promise.reject(new Error(`Cannot load buffer as an image in browser`))\n    }\n    this.image = img\n\n    return new Promise<ImageBase>((resolve, reject) => {\n      let onImageLoad = () => {\n        this._initCanvas()\n        resolve(this)\n      }\n\n      if (img!.complete) {\n        // Already loaded\n        onImageLoad()\n      } else {\n        img!.onload = onImageLoad\n        img!.onerror = (e) => reject(new Error(`Fail to load image: ${src}`))\n      }\n    })\n  }\n  clear (): void {\n    this._context.clearRect(0, 0, this._width, this._height)\n  }\n  update (imageData: ImageData): void {\n    this._context.putImageData(imageData as any, 0, 0)\n  }\n  getWidth (): number {\n    return this._width\n  }\n  getHeight (): number {\n    return this._height\n  }\n  resize (targetWidth: number, targetHeight: number, ratio: number): void {\n    let { _canvas: canvas, _context: context, image: img } = this\n\n    this._width = canvas.width = targetWidth\n    this._height = canvas.height = targetHeight\n\n    context.scale(ratio, ratio)\n    context.drawImage(img, 0, 0)\n  }\n  getPixelCount (): number {\n    return this._width * this._height\n  }\n  getImageData (): ImageData {\n    return this._context.getImageData(0, 0, this._width, this._height)\n  }\n  remove (): void {\n    if (this._canvas && this._canvas.parentNode) {\n      this._canvas.parentNode.removeChild(this._canvas)\n    }\n  }\n}\n"]}},"error":null,"hash":"6a9588d3eed16bb16e70921fa8cd48cc","cacheData":{"env":{}}}