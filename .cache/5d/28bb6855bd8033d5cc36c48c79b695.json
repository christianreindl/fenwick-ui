{"id":"node_modules/@vibrant/core/lib/pipeline/index.js","dependencies":[{"name":"/Users/christianreindl/Code/fenwick-ui/node_modules/@vibrant/core/lib/pipeline/index.js.map","includedInParent":true,"mtime":499162500000},{"name":"/Users/christianreindl/Code/fenwick-ui/package.json","includedInParent":true,"mtime":1628308770203},{"name":"/Users/christianreindl/Code/fenwick-ui/node_modules/@vibrant/core/package.json","includedInParent":true,"mtime":499162500000},{"name":"@vibrant/image","loc":{"line":40,"column":22},"parent":"/Users/christianreindl/Code/fenwick-ui/node_modules/@vibrant/core/lib/pipeline/index.js","resolved":"/Users/christianreindl/Code/fenwick-ui/node_modules/@vibrant/image/lib/index.js"}],"generated":{"js":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BasicPipeline = exports.Stage = void 0;\nvar image_1 = require(\"@vibrant/image\");\nvar Stage = /** @class */ (function () {\n    function Stage(pipeline) {\n        this.pipeline = pipeline;\n        this._map = {};\n    }\n    Stage.prototype.names = function () {\n        return Object.keys(this._map);\n    };\n    Stage.prototype.has = function (name) {\n        return !!this._map[name];\n    };\n    Stage.prototype.get = function (name) {\n        return this._map[name];\n    };\n    Stage.prototype.register = function (name, stageFn) {\n        this._map[name] = stageFn;\n        return this.pipeline;\n    };\n    return Stage;\n}());\nexports.Stage = Stage;\nvar BasicPipeline = /** @class */ (function () {\n    function BasicPipeline() {\n        this.filter = new Stage(this);\n        this.quantizer = new Stage(this);\n        this.generator = new Stage(this);\n    }\n    BasicPipeline.prototype._buildProcessTasks = function (_a) {\n        var _this = this;\n        var filters = _a.filters, quantizer = _a.quantizer, generators = _a.generators;\n        // Support wildcard for generators\n        if (generators.length === 1 && generators[0] === '*') {\n            generators = this.generator.names();\n        }\n        return {\n            filters: filters.map(function (f) { return createTask(_this.filter, f); }),\n            quantizer: createTask(this.quantizer, quantizer),\n            generators: generators.map(function (g) { return createTask(_this.generator, g); })\n        };\n        function createTask(stage, o) {\n            var name;\n            var options;\n            if (typeof o === 'string') {\n                name = o;\n            }\n            else {\n                name = o.name;\n                options = o.options;\n            }\n            return {\n                name: name,\n                fn: stage.get(name),\n                options: options\n            };\n        }\n    };\n    BasicPipeline.prototype.process = function (imageData, opts) {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, filters, quantizer, generators, imageFilterData, colors, palettes;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = this._buildProcessTasks(opts), filters = _a.filters, quantizer = _a.quantizer, generators = _a.generators;\n                        return [4 /*yield*/, this._filterColors(filters, imageData)];\n                    case 1:\n                        imageFilterData = _b.sent();\n                        return [4 /*yield*/, this._generateColors(quantizer, imageFilterData)];\n                    case 2:\n                        colors = _b.sent();\n                        return [4 /*yield*/, this._generatePalettes(generators, colors)];\n                    case 3:\n                        palettes = _b.sent();\n                        return [2 /*return*/, {\n                                colors: colors,\n                                palettes: palettes\n                            }];\n                }\n            });\n        });\n    };\n    BasicPipeline.prototype._filterColors = function (filters, imageData) {\n        return Promise.resolve(image_1.applyFilters(imageData, filters.map(function (_a) {\n            var fn = _a.fn;\n            return fn;\n        })));\n    };\n    BasicPipeline.prototype._generateColors = function (quantizer, imageData) {\n        return Promise.resolve(quantizer.fn(imageData.data, quantizer.options));\n    };\n    BasicPipeline.prototype._generatePalettes = function (generators, colors) {\n        return __awaiter(this, void 0, void 0, function () {\n            var promiseArr;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, Promise.all(generators.map(function (_a) {\n                            var fn = _a.fn, options = _a.options;\n                            return Promise.resolve(fn(colors, options));\n                        }))\n                        // Map the values to the expected name\n                    ];\n                    case 1:\n                        promiseArr = _a.sent();\n                        // Map the values to the expected name\n                        return [2 /*return*/, Promise.resolve(promiseArr.reduce(function (promises, promiseVal, i) {\n                                promises[generators[i].name] = promiseVal;\n                                return promises;\n                            }, {}))];\n                }\n            });\n        });\n    };\n    return BasicPipeline;\n}());\nexports.BasicPipeline = BasicPipeline;\n"},"sourceMaps":{"js":{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../../packages/vibrant-core/src/pipeline/index.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"c5d305a1893fb27dc4cfbe761a56ec68","cacheData":{"env":{}}}